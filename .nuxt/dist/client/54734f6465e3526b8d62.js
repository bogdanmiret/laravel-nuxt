(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{720:function(t,e,r){var content=r(856);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(13).default)("23c4750e",content,!0,{sourceMap:!1})},855:function(t,e,r){"use strict";var n=r(720);r.n(n).a},856:function(t,e,r){(e=r(12)(!1)).push([t.i,".profile-settings__avatar-wrap{background:#eee;border-radius:25px;margin-bottom:45px}",""]),t.exports=e},948:function(t,e,r){"use strict";r.r(e);r(11),r(8),r(7),r(4),r(9),r(28),r(30);var n=r(1),o=(r(34),r(3)),l=r(15),c=r(35),v=(r(47),{components:{UserAvatar:r(114).a},data:function(){return{progress:null,avatarFormData:null,cropperInstance:null,avatarEditorSrc:null,avatarPreviewUrl:null,previewSetTimeoutId:null,manualUploadInfo:null,reset:null}},methods:{onChange:function(data){this.avatarFormData=data.formData,this.cropperInstance?this.cropperInstance.replace(data.preview):this.avatarEditorSrc=data.preview},startManualUpload:function(){var t=JSON.stringify(this.cropperInstance.getData(!0));this.avatarFormData.append("cropInfo",t),this.manualUploadInfo={formData:this.avatarFormData}},onUploadDone:function(t){this.croperDestroy(),this.goToNickname(),this.$auth.setUser(t)},croperDestroy:function(){this.cropperInstance=this.progress=this.avatarEditorSrc=this.avatarPreviewUrl=null,this.reset=!0,document.querySelector(".cropper-container").remove(),this.goToNickname()},onUploadCatch:function(t){l.c.error(t.data.message)},onUploadProgress:function(t){this.progress=t.percent},goToNickname:function(){var t=this;this.$nextTick((function(){t.$vuetify.goTo("#profile-settings__nickname")}))}}}),m=r(32),f=r(38),d=r.n(f),h=r(666),_=r(101),y=r(100),x=r(677),w=r(166),C=r(51),component=Object(m.a)(v,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("v-layout",{attrs:{"align-center":"","justify-center":"",column:""}},[t.progress?[r("div",{staticClass:"text-xs-center",staticStyle:{width:"100%"}},[t._v("\n          "+t._s(t.progress)+" / 100%"),r("br"),t._v("\n          "+t._s(100===t.progress?"Обработка на сервере...":"Загрузка на сервер...")+"\n          "),r("v-progress-linear",{model:{value:t.progress,callback:function(e){t.progress=e},expression:"progress"}})],1)]:[t.$auth.user.avatar||t.avatarPreviewUrl?[r("v-scale-transition",{attrs:{appear:""}},[r("v-layout",{attrs:{"align-center":"","justify-center":""}},[r("user-avatar",{staticClass:"mx-3",attrs:{"size-name":"lg",url:t.avatarPreviewUrl}}),t._v(" "),r("user-avatar",{staticClass:"mx-3",attrs:{"size-name":"md",url:t.avatarPreviewUrl}}),t._v(" "),r("user-avatar",{staticClass:"mx-3",attrs:{"size-name":"sm",url:t.avatarPreviewUrl}}),t._v(" "),r("user-avatar",{staticClass:"mx-3",attrs:{"size-name":"circle",url:t.avatarPreviewUrl}})],1)],1)]:r("div",{staticClass:"text-xs-center"},[r("v-alert",{attrs:{value:!0,type:"info"}},[t._v("\n            У Вас нет аватарки.\n          ")])],1)],t._v(" "),r("v-scale-transition",[t.avatarEditorSrc?r("div",{staticClass:"mt-5"},[r("img",{ref:"avatarEditor",staticStyle:{"max-width":"100%"},attrs:{src:t.avatarEditorSrc}})]):t._e()]),t._v(" "),r("vue-images-manager",{attrs:{"upload-url":"/api/profile/current/set-avatar",uploadAfterChange:!1,manualUpload:t.manualUploadInfo,reset:t.reset,"hide-preview":""},on:{change:t.onChange,done:t.onUploadDone,catch:t.onUploadCatch,progress:t.onUploadProgress,"update:reset":function(e){t.reset=e}}},[r("v-btn",{directives:[{name:"show",rawName:"v-show",value:!t.progress,expression:"!progress"}],attrs:{color:"primary",rounded:"",large:""}},[r("v-icon",{attrs:{left:""}},[t._v("add_a_photo")]),t._v("\n        "+t._s(t.avatarEditorSrc?"Выбрать другое":"Выбрать")+"\n      ")],1),t._v(" "),r("span",{attrs:{slot:"buttons"},slot:"buttons"},[r("v-btn",{directives:[{name:"show",rawName:"v-show",value:t.avatarEditorSrc&&!t.progress,expression:"avatarEditorSrc && !progress"}],attrs:{color:"success",rounded:"",large:""},on:{click:t.startManualUpload}},[r("v-icon",{attrs:{left:""}},[t._v("save")]),t._v("\n          Сохранить\n        ")],1),t._v(" "),r("v-btn",{directives:[{name:"show",rawName:"v-show",value:t.avatarEditorSrc&&!t.progress,expression:"avatarEditorSrc && !progress"}],attrs:{color:"error",rounded:"",large:""},on:{click:t.croperDestroy}},[r("v-icon",{attrs:{left:""}},[t._v("close")]),t._v("\n          Отмена\n        ")],1)],1),t._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:t.progress,expression:"progress"}],staticClass:"text-xs-center",attrs:{slot:"progress"},slot:"progress"})],1)],2)],1)}),[],!1,null,null,null),k=component.exports;d()(component,{VAlert:h.a,VBtn:_.a,VIcon:y.a,VLayout:x.a,VProgressLinear:w.a,VScaleTransition:C.d});var D,S=r(773),j=r.n(S),N=r(854),O=r.n(N);function U(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function z(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?U(Object(source),!0).forEach((function(e){Object(n.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):U(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var $={transition:"slide-y-transition",scrollToTop:!0,mixins:[],components:{Avatar:k},asyncData:function(t){return Object(o.a)(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.store,e.next=3,r.dispatch("getTimezones");case 3:return e.t0=e.sent,e.next=6,r.dispatch("getCountries");case 6:return e.t1=e.sent,e.abrupt("return",{timezones:e.t0,countries:e.t1});case 8:case"end":return e.stop()}}),e)})))()},data:function(){var t=Object(l.b)(),e=this.$auth.user,r=e.firstName,n=e.lastName,o=e.gender,c=e.country,v=e.timezone,m=e.birthday;return{form:z({},D={firstName:r,lastName:n,gender:o,country:c,timezone:v,birthday:m?this.$dayjs(m):null}),formLocalizedAttributes:null,modalBirthday:null,loading:!1,currentDate:null,dateFormat:dateFormat,locale:t}},watch:{timezonesByCountry:function(t){1===t.length&&(this.form.timezone=t[0].value)}},methods:z({submit:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.validateByMixin(t.form);case 2:if(!e.sent){e.next=8;break}return t.loading=!0,e.next=6,t.setUserData(t.form);case 6:t.loading=!1,D=z({},t.form);case 8:case"end":return e.stop()}}),e)})))()},formDifference:function(){return j()(this.form,(function(t,e,r){return O()(e,D[r])?t:t.concat(r)}),[])},setCurrentDate:function(){this.currentDate=this.$dayjs()},timezonesFilter:function(i,t){return"(UTC".concat(i.offset,") ").concat(i.value," ").concat(this.timezoneCurrentTime(i)).includes(t)},getFlag:l.a},Object(c.b)("profileSettings",["setUserData"])),computed:{timezoneCurrentTime:function(){var t=this;return function(e){var r=+e.offset.slice(1,3),n=+e.offset.slice(4,6),o=t.currentDate;return(o="+"===e.offsetPrefix?o.add(r,"hours").add(n,"minutes"):o.subtract(r,"hours").subtract(n,"minutes")).toISOString().slice(11,-5)}},timezonesByCountry:function(){if(this.form.country){var t=this.form.country;return this.timezones.filter((function(i){return i.countryCode===t}))}return this.timezones},btnDisabled:function(){return!!this.errors.items.length}},created:function(){this.setCurrentDate(),setInterval(this.setCurrentDate,1e3)},destroyed:function(){clearInterval(this.setCurrentDate)}},P=(r(855),r(857)),V=r(669),T=r(943),E=r(767),I=r(676),F=r(744),B=r(745),A=r(674),R=r(652),L=Object(m.a)($,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("v-layout",{attrs:{"align-center":"","justify-center":""}},[r("v-alert",{staticClass:"mb-3",attrs:{value:!t.$auth.user.mainEmail&&t.$auth.user.password,type:"info"}},[t._v("\n            Для Вас не доступен вход с паролем используя почту, потому что у вас нет почты.\n            Но вы можете входить через ник "),r("b",[t._v(t._s(t.$auth.user.nickname))]),t._v(" "),t.$auth.user.socAccounts.length?r("router-link",{attrs:{to:"/profile/settings/soc-accounts"}},[t._v("\n                и прикрепленные аккаунты\n            ")]):t._e(),t._v(" "),r("v-btn",{attrs:{to:"/profile/settings/emails"}},[r("v-icon",{attrs:{left:""}},[t._v("add")]),t._v("\n                Добавить почту\n            ")],1)],1),t._v(" "),r("v-alert",{staticClass:"mb-3",attrs:{value:!t.$auth.user.password,type:"info"}},[t._v("\n            У вас не настроен вход через пароль используя почту или ник.\n            "),r("v-btn",{attrs:{to:"/profile/settings/password"}},[r("v-icon",{attrs:{left:""}},[t._v("add")]),t._v("\n                Добавить эту возможность\n            ")],1)],1)],1),t._v(" "),r("div",{staticClass:"text-xs-center mb-4",attrs:{id:"profile-settings__nickname"}},[r("span",{staticClass:"display-2"},[t._v(t._s(t.$auth.user.nickname))]),r("br"),t._v(" "),r("span",{staticClass:"grey--text"},[t._v("Ник изменить нельзя")])]),t._v(" "),r("v-container",{staticClass:"profile-settings__avatar-wrap"},[r("div",{staticClass:"title text-xs-center pb-4"},[t._v("\n            Ваш аватар\n        ")]),t._v(" "),r("avatar")],1),t._v(" "),r("v-layout",{attrs:{"justify-center":"",row:"",wrap:""}},[r("v-flex",{staticClass:"px-2 pb-3",attrs:{sm12:"",md10:"",lg6:"",xl5:""}},[r("form",{attrs:{autocomplete:"on"},on:{submit:function(e){return e.preventDefault(),t.submit(e)}}},[r("v-text-field",{attrs:{label:"Имя","error-messages":t.errors.collect("firstName"),"data-vv-name":"firstName",required:""},model:{value:t.form.firstName,callback:function(e){t.$set(t.form,"firstName",e)},expression:"form.firstName"}}),t._v(" "),r("v-text-field",{attrs:{label:"Фамилия","error-messages":t.errors.collect("lastName"),"data-vv-name":"lastName",required:""},model:{value:t.form.lastName,callback:function(e){t.$set(t.form,"lastName",e)},expression:"form.lastName"}}),t._v(" "),r("v-autocomplete",{attrs:{items:t.countries,"item-value":"countryCode",label:"Страна","prepend-icon":"location_on"},scopedSlots:t._u([{key:"selection",fn:function(e){var n=e.item;e.selected;return[r("div",{staticStyle:{width:"25px"}},[r("img",{staticClass:"country-flag",attrs:{src:t.getFlag(n.flagName)}})]),t._v(" "),r("span",{staticClass:"ml-2"},[t._v(t._s(n.text))])]}},{key:"item",fn:function(e){var n=e.item;e.tile;return[r("img",{staticClass:"country-flag",staticStyle:{"max-width":"30px"},attrs:{src:t.getFlag(n.flagName)}}),t._v(" "),r("span",{staticClass:"ml-3"},[t._v(t._s(n.text))])]}}]),model:{value:t.form.country,callback:function(e){t.$set(t.form,"country",e)},expression:"form.country"}}),t._v(" "),r("v-autocomplete",{attrs:{items:t.timezonesByCountry,filter:t.timezonesFilter,"item-text":function(i){return"(UTC"+i.offset+") "+i.value},label:"Временная зона","prepend-icon":"access_time","persistent-hint":""},scopedSlots:t._u([{key:"item",fn:function(e){var n=e.item;return[r("v-list-tile-content",{staticClass:"pr-3"},[r("img",{staticClass:"country-flag",staticStyle:{"max-width":"30px"},attrs:{src:t.getFlag(n.flagName)}})]),t._v(" "),r("v-list-tile-title",[t._v("\n                            (UTC"+t._s(n.offset)+") "),r("b",[t._v(t._s(n.value))])]),t._v(" "),r("v-list-tile-action",{staticClass:"grey--text ml-2"},[t._v("\n                            "+t._s(t.timezoneCurrentTime(n))+"\n                        ")])]}}]),model:{value:t.form.timezone,callback:function(e){t.$set(t.form,"timezone",e)},expression:"form.timezone"}}),t._v(" "),r("v-radio-group",{attrs:{label:"Пол:",row:""},model:{value:t.form.gender,callback:function(e){t.$set(t.form,"gender",e)},expression:"form.gender"}},[r("v-layout",{attrs:{"justify-space-around":""}},[r("v-radio",{attrs:{label:"Мужчина",value:!0}}),t._v(" "),r("v-radio",{attrs:{label:"Женщина",value:!1}}),t._v(" "),r("v-radio",{attrs:{label:"Не указано",value:null}})],1)],1),t._v(" "),r("v-dialog",{ref:"dialog",attrs:{"return-value":t.form.birthday,width:"290px",persistent:"",lazy:"","full-width":""},on:{"update:returnValue":function(e){return t.$set(t.form,"birthday",e)},"update:return-value":function(e){return t.$set(t.form,"birthday",e)}},model:{value:t.modalBirthday,callback:function(e){t.modalBirthday=e},expression:"modalBirthday"}},[r("v-text-field",{attrs:{slot:"activator",label:"День рождения","prepend-icon":"event",readonly:""},slot:"activator",model:{value:t.form.birthday,callback:function(e){t.$set(t.form,"birthday",e)},expression:"form.birthday"}}),t._v(" "),r("v-date-picker",{attrs:{locale:t.locale,scrollable:""},model:{value:t.form.birthday,callback:function(e){t.$set(t.form,"birthday",e)},expression:"form.birthday"}},[r("v-spacer"),t._v(" "),r("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(e){t.modalBirthday=!1}}},[t._v("Отмена")]),t._v(" "),r("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(e){return t.$refs.dialog.save(t.form.birthday)}}},[t._v("Ок")])],1)],1),t._v(" "),r("v-alert",{staticClass:"mb-3",attrs:{value:t.formDifference().length,type:"info"}},[t._v("\n                    Измененные поля: "+t._s(t.formDifference().map((function(e){return t.formLocalizedAttributes[e]})).join(", "))+".\n                ")]),t._v(" "),r("v-btn",{directives:[{name:"show",rawName:"v-show",value:t.formDifference().length,expression:"formDifference().length"}],attrs:{color:"success",loading:t.loading,disabled:t.btnDisabled,large:"",block:""},on:{click:t.submit}},[r("v-icon",{attrs:{left:""}},[t._v("save")]),t._v("\n                    Сохранить\n                ")],1)],1)])],1)],1)}),[],!1,null,null,null);e.default=L.exports;d()(L,{VAlert:h.a,VAutocomplete:P.a,VBtn:_.a,VContainer:V.a,VDatePicker:T.a,VDialog:E.a,VFlex:I.a,VIcon:y.a,VLayout:x.a,VRadio:F.a,VRadioGroup:B.a,VSpacer:A.a,VTextField:R.a})}}]);